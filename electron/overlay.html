<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Mirror</title>

    <!-- xterm.js styles and scripts (UMD bundles, not ES modules) -->
    <link rel="stylesheet" href="../node_modules/xterm/css/xterm.css">
    <script src="../node_modules/xterm/lib/xterm.js"></script>
    <script src="../node_modules/xterm-addon-fit/lib/xterm-addon-fit.js"></script>

    <!-- Markdown rendering -->
    <script src="../node_modules/marked/lib/marked.umd.js"></script>
    <script src="../node_modules/dompurify/dist/purify.min.js"></script>

    <!-- Voice Mirror Styles -->
    <link rel="stylesheet" href="styles/tokens.css">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/orb.css">
    <link rel="stylesheet" href="styles/panel.css">
    <link rel="stylesheet" href="styles/chat.css">
    <link rel="stylesheet" href="styles/terminal.css">
    <link rel="stylesheet" href="styles/settings.css">
    <link rel="stylesheet" href="styles/notifications.css">
</head>
<body>
    <!-- Orb View (collapsed) -->
    <!-- Outer ring: draggable via -webkit-app-region: drag -->
    <!-- Inner button: clickable via -webkit-app-region: no-drag -->
    <div id="orb" class="listening">
        <button id="orb-button" title="Click to expand">
            <img id="orb-icon" src="../assets/icon-64.png" alt="Voice Mirror">
        </button>
    </div>

    <!-- Panel View (expanded) -->
    <div id="panel">
        <div id="panel-header">
            <div class="orb-mini" onclick="collapse()">
                <img src="../assets/icon-32.png" alt="Voice Mirror">
            </div>
            <h1>Voice Mirror</h1>
        </div>

        <div id="chat-container">
            <!-- Welcome message - updated dynamically based on activation mode -->
            <div id="welcome-message" class="message-group assistant">
                <div class="message-avatar">ðŸ¤–</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">Voice Mirror</span>
                        <span class="message-time">Now</span>
                    </div>
                    <div id="welcome-bubble" class="message-bubble">
                        Loading...
                        <button class="message-copy-btn" onclick="copyMessage(this)" title="Copy">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toast-container"></div>

        <!-- Image Preview (shown when image is pasted/dropped) -->
        <div id="image-preview">
            <img id="preview-image" src="" alt="Preview">
            <div class="preview-info">
                <div id="preview-filename">screenshot.png</div>
                <div id="preview-size">0 KB</div>
            </div>
            <div class="preview-actions">
                <button class="send-btn" onclick="sendImage()">Send</button>
                <button class="cancel-btn" onclick="cancelImage()">Cancel</button>
            </div>
        </div>

        <!-- Terminal Panel (visible by default, collapsible) -->
        <div id="terminal-container">
            <div id="terminal-header">
                <span class="terminal-title">âŒ˜ Claude Code</span>
                <span id="terminal-status" class="terminal-status stopped">Stopped</span>
                <button id="terminal-start" class="control-btn start" onclick="startClaude()">Start</button>
                <div class="terminal-controls">
                    <button class="terminal-ctrl-btn" onclick="minimizeTerminal()" title="Minimize">â”€</button>
                    <button class="terminal-ctrl-btn" onclick="hideTerminal()" title="Hide">Ã—</button>
                </div>
            </div>
            <div id="xterm-container"></div>
        </div>

        <div id="status-bar">
            <div id="status-indicator"></div>
            <span id="status-text">Listening...</span>
            <div id="action-buttons">
                <!-- Call Mode Toggle -->
                <button id="call-mode-btn" class="action-btn" onclick="toggleCallMode()" title="Call Mode (always listening)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                    </svg>
                </button>
                <button class="action-btn" onclick="captureScreen()" title="Capture Screen">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </button>
                <button class="action-btn terminal-btn" onclick="toggleTerminal()" title="Toggle Terminal">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="4 17 10 11 4 5"/>
                        <line x1="12" y1="19" x2="20" y2="19"/>
                    </svg>
                    <span id="claude-badge" class="badge stopped"></span>
                </button>
                <button class="action-btn" onclick="toggleSettings()" title="Settings">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Drop zone overlay -->
        <div id="drop-zone">Drop image here</div>

        <!-- Settings Panel -->
        <div id="settings-panel">
            <div id="settings-header">
                <h2>Settings</h2>
                <button id="settings-close-btn" class="settings-close">&times;</button>
            </div>
            <div id="settings-content">
                <!-- Activation Mode -->
                <div class="settings-section">
                    <h3>Activation Mode</h3>
                    <div class="settings-group">
                        <label class="radio-option">
                            <input type="radio" name="activationMode" value="wakeWord" checked>
                            <span class="radio-label">Wake Word</span>
                            <span class="radio-desc">Say "Hey Claude" to activate</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="activationMode" value="callMode">
                            <span class="radio-label">Call Mode</span>
                            <span class="radio-desc">Always listening, no wake word needed</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="activationMode" value="pushToTalk">
                            <span class="radio-label">Push to Talk</span>
                            <span class="radio-desc">Hold a key to record</span>
                        </label>
                    </div>
                </div>

                <!-- Keybinds -->
                <div class="settings-section">
                    <h3>Keyboard Shortcuts</h3>
                    <div class="settings-group">
                        <div class="keybind-row">
                            <span class="keybind-label">Toggle Panel</span>
                            <button class="keybind-input" id="keybind-toggle" data-key="behavior.hotkey">
                                Ctrl+Shift+V
                            </button>
                        </div>
                        <div class="keybind-row" id="ptt-keybind-row" style="display: none;">
                            <span class="keybind-label">Push to Talk</span>
                            <button class="keybind-input" id="keybind-ptt" data-key="behavior.pttKey">
                                Space
                            </button>
                        </div>
                    </div>
                    <p class="settings-hint">Click a button, then press a key or mouse button (side buttons supported)</p>
                </div>

                <!-- Wake Word Settings -->
                <div class="settings-section" id="wake-word-settings">
                    <h3>Wake Word</h3>
                    <div class="settings-group">
                        <div class="setting-row">
                            <label>Phrase</label>
                            <select id="wake-word-phrase">
                                <option value="hey_claude">Hey Claude</option>
                                <option value="hey_jarvis">Hey Jarvis</option>
                                <option value="alexa">Alexa</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label>Sensitivity</label>
                            <div class="slider-container">
                                <input type="range" id="wake-word-sensitivity" min="0.1" max="0.9" step="0.1" value="0.5">
                                <span id="sensitivity-value">0.5</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Voice Settings -->
                <div class="settings-section">
                    <h3>Voice</h3>
                    <div class="settings-group">
                        <div class="setting-row">
                            <label>TTS Voice</label>
                            <select id="tts-voice">
                                <option value="af_bella">Bella (Female)</option>
                                <option value="af_nicole">Nicole (Female)</option>
                                <option value="af_sarah">Sarah (Female)</option>
                                <option value="am_adam">Adam (Male)</option>
                                <option value="am_michael">Michael (Male)</option>
                                <option value="bf_emma">Emma (British)</option>
                                <option value="bm_george">George (British)</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label>Speech Speed</label>
                            <div class="slider-container">
                                <input type="range" id="tts-speed" min="0.5" max="2.0" step="0.1" value="1.0">
                                <span id="speed-value">1.0x</span>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label>STT Model</label>
                            <select id="stt-model">
                                <option value="parakeet">Parakeet (Fast)</option>
                                <option value="whisper">Whisper (Accurate)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Appearance -->
                <div class="settings-section">
                    <h3>Appearance</h3>
                    <div class="settings-group">
                        <div class="setting-row">
                            <label>Orb Size</label>
                            <div class="slider-container">
                                <input type="range" id="orb-size" min="48" max="96" step="8" value="64">
                                <span id="orb-size-value">64px</span>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label>Theme</label>
                            <select id="theme-select">
                                <option value="dark">Dark</option>
                                <option value="light">Light (Coming Soon)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Behavior -->
                <div class="settings-section">
                    <h3>Behavior</h3>
                    <div class="settings-group">
                        <label class="checkbox-option">
                            <input type="checkbox" id="start-minimized">
                            <span>Start minimized to tray</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" id="click-to-talk">
                            <span>Click orb to start recording</span>
                        </label>
                    </div>
                </div>

                <!-- Actions -->
                <div class="settings-actions">
                    <button class="settings-btn secondary" onclick="resetSettings()">Reset to Defaults</button>
                    <button class="settings-btn primary" onclick="saveSettings()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Voice Mirror Scripts (ES modules) -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
